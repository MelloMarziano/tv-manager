"use strict";(self.webpackChunktv_manager=self.webpackChunktv_manager||[]).push([[76],{4730:(P,D,r)=>{r.d(D,{M:()=>e});var l=r(4572),d=r(6354),E=r(5558),f=r(7705),u=r(8515),_=r(3787);let e=(()=>{class t{constructor(a,n){this.firestore=a,this.televisorService=n,this.collection="clientes"}getClientes(){return this.firestore.collection(this.collection).snapshotChanges().pipe((0,d.T)(a=>a.map(n=>({...n.payload.doc.data(),id:n.payload.doc.id}))),(0,E.n)(a=>{if(0===a.length)return[[]];const n=a.map(T=>this.televisorService.contarTelevisoresPorCliente(T.id).pipe((0,d.T)(i=>({...T,televisores:new Array(i).fill(null)}))));return(0,l.z)(n)}))}getClienteById(a){return this.firestore.doc(`${this.collection}/${a}`).valueChanges({idField:"id"})}createCliente(a){const n={...a,activo:a.activo??!0,fechaCreacion:new Date,configuracion:{rotacionAutomatica:!0,tiempoRotacion:5e3,horarioOperacion:{inicio:"08:00",fin:"18:00"},...a.configuracion}};return this.firestore.collection(this.collection).add(n)}updateCliente(a,n){return this.firestore.doc(`${this.collection}/${a}`).update(n)}deleteCliente(a){return this.firestore.doc(`${this.collection}/${a}`).delete()}getClientesActivos(){return this.firestore.collection(this.collection,a=>a.where("activo","==",!0)).snapshotChanges().pipe((0,d.T)(a=>a.map(n=>({...n.payload.doc.data(),id:n.payload.doc.id}))))}static{this.\u0275fac=function(n){return new(n||t)(f.KVO(u.Qe),f.KVO(_.N))}}static{this.\u0275prov=f.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})()},4965:(P,D,r)=>{r.d(D,{D:()=>a});var l=r(8455),d=r(6354),E=r(980),f=r(5964),u=r(6697),_=r(5558),e=r(7705),t=r(8515),p=r(3383);let a=(()=>{class n{constructor(i,o){this.firestore=i,this.storage=o,this.collection="imagenes",this.storagePath="imagenes"}getAllImagenes(){return this.firestore.collection(this.collection).snapshotChanges().pipe((0,d.T)(i=>i.map(o=>({...o.payload.doc.data(),id:o.payload.doc.id})).sort((o,s)=>new Date(s.fechaCreacion).getTime()-new Date(o.fechaCreacion).getTime())))}getImagenesByTelevisor(i){return this.firestore.collection(this.collection,o=>o.where("televisorId","==",i)).snapshotChanges().pipe((0,d.T)(o=>o.map(s=>({...s.payload.doc.data(),id:s.payload.doc.id})).sort((s,c)=>new Date(c.fechaCreacion).getTime()-new Date(s.fechaCreacion).getTime())))}uploadImagen(i,o,s,c){const v=`${Date.now()}_${i.name}`,h=`${this.storagePath}/${o}/${v}`,m=this.storage.ref(h),O=this.storage.upload(h,i);return console.log("\u{1f504} Iniciando upload de imagen:",v),console.log("\u{1f4c1} Ruta del archivo:",h),O.snapshotChanges().pipe((0,E.j)(()=>{console.log("\u2705 Upload task finalizado")}),(0,f.p)(g=>null!=g&&"success"===g.state),(0,u.s)(1),(0,_.n)(()=>(console.log("\u{1f517} Upload completado exitosamente, obteniendo URL..."),m.getDownloadURL())),(0,_.n)(g=>{console.log("\u2705 URL de descarga obtenida:",g);const C={nombre:s,url:g,televisorId:o,clienteId:c,fechaCreacion:new Date,horarios:[]};return console.log("\u{1f4be} Guardando datos en Firestore:",C),(0,l.H)(this.firestore.collection(this.collection).add(C)).pipe((0,d.T)(M=>{const I={id:M.id,...C};return console.log("\u2705 Imagen guardada completamente:",I),I}))}))}updateHorarios(i,o){return(0,l.H)(this.firestore.collection(this.collection).doc(i).update({horarios:o}))}deleteImagen(i){const o=this.storage.refFromURL(i.url);return(0,l.H)(o.delete()).pipe((0,_.n)(()=>(0,l.H)(this.firestore.collection(this.collection).doc(i.id).delete())))}agregarHorario(i,o){const s={id:this.firestore.createId(),...o};return this.firestore.collection(this.collection).doc(i).get().pipe((0,_.n)(c=>{if(c.exists){const h=[...c.data().horarios||[],s];return(0,l.H)(c.ref.update({horarios:h}))}throw new Error("Imagen no encontrada")}))}eliminarHorario(i,o){return this.firestore.collection(this.collection).doc(i).get().pipe((0,_.n)(s=>{if(s.exists){const v=(s.data().horarios||[]).filter(h=>h.id!==o);return(0,l.H)(s.ref.update({horarios:v}))}throw new Error("Imagen no encontrada")}))}getImagenesActivasEnHorario(i,o=new Date){const s=o.getDay(),c=o.toTimeString().slice(0,5);return this.getImagenesByTelevisor(i).pipe((0,d.T)(v=>v.filter(h=>!h.horarios||0===h.horarios.length||h.horarios.some(m=>m.dias.some(C=>C.value===s)&&c>=m.horaInicio&&c<=m.horaFin))))}getDiasSemana(){return[{value:1,label:"Lunes"},{value:2,label:"Martes"},{value:3,label:"Mi\xe9rcoles"},{value:4,label:"Jueves"},{value:5,label:"Viernes"},{value:6,label:"S\xe1bado"},{value:0,label:"Domingo"}]}static{this.\u0275fac=function(o){return new(o||n)(e.KVO(t.Qe),e.KVO(p.ap))}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()},3787:(P,D,r)=>{r.d(D,{N:()=>f});var l=r(6354),d=r(7705),E=r(8515);let f=(()=>{class u{constructor(e){this.firestore=e,this.collection="televisores"}getTelevisores(){return this.firestore.collection(this.collection).snapshotChanges().pipe((0,l.T)(e=>e.map(t=>({...t.payload.doc.data(),id:t.payload.doc.id}))))}getTelevisoresByCliente(e){return this.firestore.collection(this.collection,t=>t.where("clienteId","==",e)).snapshotChanges().pipe((0,l.T)(t=>t.map(p=>({...p.payload.doc.data(),id:p.payload.doc.id}))))}getTelevisorById(e){return this.firestore.doc(`${this.collection}/${e}`).valueChanges({idField:"id"})}createTelevisor(e){const t={...e,activo:e.activo??!0,estado:e.estado??"Activo",ultimaConexion:new Date,fechaCreacion:new Date,configuracion:{resolucion:"1920x1080",orientacion:"horizontal",tiempoTransicion:5e3,...e.configuracion},imagenes:0};return this.firestore.collection(this.collection).add(t)}updateTelevisor(e,t){return this.firestore.doc(`${this.collection}/${e}`).update(t)}deleteTelevisor(e){return this.firestore.doc(`${this.collection}/${e}`).delete()}asignarTelevisorACliente(e,t,p){return this.firestore.doc(`${this.collection}/${e}`).update({clienteId:t,clienteNombre:p})}desasignarTelevisorDeCliente(e){return this.firestore.doc(`${this.collection}/${e}`).update({clienteId:null,clienteNombre:null})}actualizarEstado(e,t){return this.firestore.doc(`${this.collection}/${e}`).update({estado:t,ultimaConexion:new Date})}getTelevisoresActivos(){return this.firestore.collection(this.collection,e=>e.where("activo","==",!0)).snapshotChanges().pipe((0,l.T)(e=>e.map(t=>({...t.payload.doc.data(),id:t.payload.doc.id}))))}getTelevisoresSinAsignar(){return this.firestore.collection(this.collection,e=>e.where("clienteId","==",null)).snapshotChanges().pipe((0,l.T)(e=>e.map(t=>({...t.payload.doc.data(),id:t.payload.doc.id}))))}contarTelevisoresPorCliente(e){return this.getTelevisoresByCliente(e).pipe((0,l.T)(t=>t.length))}static{this.\u0275fac=function(t){return new(t||u)(d.KVO(E.Qe))}}static{this.\u0275prov=d.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()}}]);