"use strict";(self.webpackChunktv_manager=self.webpackChunktv_manager||[]).push([[466],{9466:(Q,v,l)=>{l.r(v),l.d(v,{TelevisoresPageModule:()=>K});var C=l(7970),g=l(4341),u=l(177),b=l(9559),m=l(467),M=l(9350);function f(i,r){const t="object"==typeof r;return new Promise((n,o)=>{let a,s=!1;i.subscribe({next:c=>{a=c,s=!0},error:o,complete:()=>{s?n(a):t?n(r.defaultValue):o(new M.G)}})})}var h=l(6697),e=l(7705),O=l(3787),x=l(4730),k=l(4965),T=l(6959);let y=(()=>{class i{constructor(t){var n=this;this.snakBar=t,this.horizontalPosition="end",this.verticalPosition="top",this.showSnak=function(){var o=(0,m.A)(function*(s,a,c=2e3){yield n.snakBar.open(s,"",{verticalPosition:n.verticalPosition,horizontalPosition:n.horizontalPosition,panelClass:[a],duration:c})});return function(s,a){return o.apply(this,arguments)}}()}presentToastDanger(t){var n=this;return(0,m.A)(function*(o,s=2e3){yield n.showSnak(o,"danger-snackbar",s)}).apply(this,arguments)}presentToastWarning(t){var n=this;return(0,m.A)(function*(o,s=2e3){yield n.showSnak(o,"warning-snackbar",s)}).apply(this,arguments)}presentToastSuccess(t){var n=this;return(0,m.A)(function*(o,s=2e3){yield n.showSnak(o,"success-snackbar",s)}).apply(this,arguments)}static{this.\u0275fac=function(n){return new(n||i)(e.KVO(T.UG))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function S(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",13)(1,"div",14)(2,"div",15)(3,"h5",16),e.nrm(4,"i",17),e.EFF(5),e.k0s(),e.j41(6,"p",18),e.nrm(7,"i",19),e.EFF(8),e.k0s(),e.j41(9,"div",20)(10,"span"),e.nrm(11,"i",21),e.EFF(12),e.k0s(),e.j41(13,"button",22),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.openImageModal(s))}),e.EFF(14,"Gestionar"),e.k0s()()()()()}if(2&i){const t=r.$implicit;e.R7$(5),e.JRh(t.nombre),e.R7$(3),e.JRh(t.ubicacion),e.R7$(4),e.SpI("",t.imagenesCount," im\xe1genes")}}function I(i,r){if(1&i&&(e.j41(0,"div",11),e.DNE(1,S,15,3,"div",12),e.k0s()),2&i){const t=e.XpG();e.R7$(1),e.Y8G("ngForOf",t.filteredTvs)}}function F(i,r){if(1&i&&(e.j41(0,"div",23),e.nrm(1,"i",24),e.j41(2,"h3"),e.EFF(3),e.k0s()()),2&i){const t=e.XpG();e.R7$(3),e.JRh(t.emptyStateMessage)}}function j(i,r){1&i&&(e.j41(0,"div",55),e.EFF(1,"24/7 Activo"),e.k0s())}function w(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",58)(1,"span",59)(2,"strong"),e.EFF(3),e.k0s(),e.EFF(4),e.k0s(),e.j41(5,"button",60),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(2).$implicit,c=e.XpG(4);return e.Njj(c.removeSchedule(a,s.id))}),e.nrm(6,"i",61),e.k0s()()}if(2&i){const t=r.$implicit,n=e.XpG(6);e.R7$(3),e.SpI("",n.getDaysText(t.dias),":"),e.R7$(1),e.Lme(" ",t.horaInicio," - ",t.horaFin,"")}}function E(i,r){if(1&i&&(e.j41(0,"div",56),e.DNE(1,w,7,3,"div",57),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(1),e.Y8G("ngForOf",t.horarios)}}function D(i,r){1&i&&(e.j41(0,"div",62),e.EFF(1,"Sin programar"),e.k0s())}function $(i,r){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.nrm(2,"div",44),e.k0s(),e.j41(3,"td",45),e.nrm(4,"img",46),e.EFF(5),e.k0s(),e.j41(6,"td"),e.DNE(7,j,2,0,"div",47),e.DNE(8,E,2,1,"div",48),e.DNE(9,D,2,0,"div",49),e.k0s(),e.j41(10,"td",50)(11,"button",51),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(4);return e.Njj(a.programarImagen(s))}),e.nrm(12,"i",52),e.k0s(),e.j41(13,"button",53),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(4);return e.Njj(a.deleteImage(s))}),e.nrm(14,"i",54),e.k0s()()()}if(2&i){const t=r.$implicit,n=e.XpG(4);e.R7$(2),e.xc7("background-color",t.uiColor),e.R7$(1),e.Y8G("title",t.nombre),e.R7$(1),e.Y8G("src",t.url,e.B4B),e.R7$(1),e.SpI(" ",t.nombre,""),e.R7$(2),e.Y8G("ngIf",n.is24_7(t)),e.R7$(1),e.Y8G("ngIf",!n.is24_7(t)&&t.horarios.length>0),e.R7$(1),e.Y8G("ngIf",!n.is24_7(t)&&0===t.horarios.length)}}function G(i,r){if(1&i&&(e.j41(0,"table",39)(1,"thead")(2,"tr"),e.nrm(3,"th",40),e.j41(4,"th",41),e.EFF(5,"Nombre"),e.k0s(),e.j41(6,"th",41),e.EFF(7,"Programaci\xf3n"),e.k0s(),e.j41(8,"th",42),e.EFF(9,"Acciones"),e.k0s()()(),e.j41(10,"tbody"),e.DNE(11,$,15,8,"tr",43),e.k0s()()),2&i){const t=e.XpG(3);e.R7$(11),e.Y8G("ngForOf",t.selectedTvImages)}}function R(i,r){1&i&&(e.j41(0,"div",23),e.nrm(1,"i",63),e.j41(2,"h4",64),e.EFF(3,"No hay im\xe1genes"),e.k0s()())}function N(i,r){if(1&i&&(e.j41(0,"div"),e.DNE(1,G,12,1,"table",37),e.DNE(2,R,4,0,"ng-template",null,38,e.C5r),e.k0s()),2&i){const t=e.sdS(3),n=e.XpG(2);e.R7$(1),e.Y8G("ngIf",n.selectedTvImages.length>0)("ngIfElse",t)}}function X(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",82)(1,"input",83),e.bIt("change",function(){const s=e.eBV(t).$implicit,a=e.XpG(3);return e.Njj(a.onDayChange(s))}),e.k0s(),e.j41(2,"label",84),e.EFF(3),e.k0s()()}if(2&i){const t=r.$implicit,n=e.XpG(3);e.R7$(1),e.Y8G("id","day-"+t.value)("checked",n.selectedDays.includes(t.value)),e.R7$(1),e.Y8G("for","day-"+t.value),e.R7$(1),e.JRh(t.label)}}function V(i,r){if(1&i&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(1),e.JRh(t.time)}}function Y(i,r){if(1&i&&(e.j41(0,"span",92),e.EFF(1),e.nI1(2,"uppercase"),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(1),e.JRh(t.occupiedBy?e.bMT(2,1,t.occupiedBy.charAt(0)):"")}}const B=function(i,r){return{"is-available":i,"is-selected":r}};function A(i,r){if(1&i){const t=e.RV6();e.j41(0,"button",89),e.bIt("click",function(){const s=e.eBV(t).$implicit,a=e.XpG(4);return e.Njj(a.onTimeSlotClick(s))}),e.DNE(1,V,2,1,"span",90),e.DNE(2,Y,3,3,"span",91),e.k0s()}if(2&i){const t=r.$implicit;e.xc7("background-color","occupied"===t.status?t.color:null)("border-color","occupied"===t.status?t.color:null),e.Y8G("disabled","occupied"===t.status)("ngClass",e.l_i(9,B,"available"===t.status,"selected"===t.status))("title","occupied"===t.status?"Ocupado por: "+t.occupiedBy:t.time),e.R7$(1),e.Y8G("ngIf","occupied"!==t.status),e.R7$(1),e.Y8G("ngIf","occupied"===t.status)}}function z(i,r){if(1&i&&(e.j41(0,"div",85)(1,"label",71),e.EFF(2,"2. Selecciona el rango de horas"),e.k0s(),e.j41(3,"div",86)(4,"div",87),e.DNE(5,A,3,12,"button",88),e.k0s()()()),2&i){const t=e.XpG(3);e.R7$(5),e.Y8G("ngForOf",t.timeSlots)}}function U(i,r){1&i&&e.nrm(0,"span",93)}function H(i,r){if(1&i){const t=e.RV6();e.j41(0,"div")(1,"div",65)(2,"button",66),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.backToImages())}),e.nrm(3,"i",67),e.k0s(),e.j41(4,"div")(5,"h4",68),e.EFF(6),e.k0s()()(),e.j41(7,"form",69),e.bIt("ngSubmit",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.addScheduleToImage())}),e.j41(8,"div",70)(9,"label",71),e.EFF(10,"1. Selecciona los d\xedas"),e.k0s(),e.j41(11,"div",72),e.DNE(12,X,4,4,"div",73),e.k0s()(),e.DNE(13,z,6,1,"div",74),e.j41(14,"div",75)(15,"div")(16,"span",76),e.EFF(17,"Inicio: "),e.j41(18,"strong"),e.EFF(19),e.k0s()(),e.j41(20,"span"),e.EFF(21,"Fin: "),e.j41(22,"strong"),e.EFF(23),e.k0s()()(),e.j41(24,"button",77),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearScheduleSelection())}),e.EFF(25,"Limpiar selecci\xf3n"),e.k0s()(),e.j41(26,"div",78)(27,"button",79),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.backToImages())}),e.EFF(28,"Cancelar"),e.k0s(),e.j41(29,"button",80),e.DNE(30,U,1,0,"span",81),e.EFF(31," Guardar Horario "),e.k0s()()()()}if(2&i){const t=e.XpG(2);e.R7$(6),e.SpI("Programar: ",null==t.selectedImage?null:t.selectedImage.nombre,""),e.R7$(1),e.Y8G("formGroup",t.scheduleForm),e.R7$(5),e.Y8G("ngForOf",t.diasSemana),e.R7$(1),e.Y8G("ngIf",t.selectedDays.length>0),e.R7$(6),e.JRh(t.scheduleForm.value.horaInicio||"--:--"),e.R7$(4),e.JRh(t.scheduleForm.value.horaFin||"--:--"),e.R7$(6),e.Y8G("disabled",t.scheduleForm.invalid||t.guardandoHorario),e.R7$(1),e.Y8G("ngIf",t.guardandoHorario)}}function J(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",25),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeImageModal())}),e.j41(1,"div",26),e.bIt("click",function(o){return o.stopPropagation()}),e.j41(2,"div",27)(3,"h3"),e.EFF(4),e.k0s(),e.j41(5,"button",28),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.closeImageModal())}),e.k0s()(),e.j41(6,"div",29)(7,"div",30)(8,"button",31),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.currentModalStep="images")}),e.nrm(9,"i",32),e.EFF(10,"Im\xe1genes"),e.k0s(),e.j41(11,"button",33),e.nrm(12,"i",34),e.EFF(13,"Programar"),e.k0s()(),e.j41(14,"div",35),e.DNE(15,N,4,2,"div",36),e.DNE(16,H,32,8,"div",36),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(4),e.SpI("Gesti\xf3n de Im\xe1genes: ",null==t.selectedTv?null:t.selectedTv.nombre,""),e.R7$(4),e.AVh("active","images"===t.currentModalStep),e.R7$(3),e.AVh("active","schedule"===t.currentModalStep),e.Y8G("disabled",!t.selectedImage),e.R7$(3),e.Y8G("ngSwitch",t.currentModalStep),e.R7$(1),e.Y8G("ngSwitchCase","images"),e.R7$(1),e.Y8G("ngSwitchCase","schedule")}}let P=(()=>{class i{constructor(t,n,o,s,a,c,d){this.fb=t,this.route=n,this.router=o,this.televisorService=s,this.clienteService=a,this.imagenService=c,this.snackbarService=d,this.allTvs=[],this.filteredTvs=[],this.clientesDisponibles=[],this.selectedTv=null,this.selectedTvImages=[],this.selectedImage=null,this.clienteId=null,this.clienteNombre="",this.pageTitle="",this.pageSubtitle="",this.emptyStateMessage="",this.isUploading=!1,this.guardandoHorario=!1,this.showImageModal=!1,this.isDragOver=!1,this.currentModalStep="images",this.selectedFiles=[],this.colorPalette=["#3498db","#2ecc71","#e74c3c","#f1c40f","#9b59b6","#1abc9c","#e67e22","#34495e"],this.diasSemana=[{value:1,label:"Lunes"},{value:2,label:"Martes"},{value:3,label:"Mi\xe9rcoles"},{value:4,label:"Jueves"},{value:5,label:"Viernes"},{value:6,label:"S\xe1bado"},{value:0,label:"Domingo"}],this.selectedDays=[],this.timeSlots=[],this.selectionStart=null}ngOnInit(){this.initializeForms(),this.route.queryParams.subscribe(t=>{this.clienteId=t.clienteId||null,this.loadInitialData()})}initializeForms(){this.newTvForm=this.fb.group({nombre:["",[g.k0.required,g.k0.minLength(2)]],ubicacion:["",g.k0.required],resolucion:["1920x1080",g.k0.required],clienteId:["",this.clienteId?[]:[g.k0.required]]}),this.scheduleForm=this.fb.group({horaInicio:["",g.k0.required],horaFin:["",g.k0.required]},{validators:this.timeRangeValidator})}timeRangeValidator(t){const n=t.get("horaInicio")?.value,o=t.get("horaFin")?.value;return n&&o&&n>=o?{invalidTimeRange:!0}:null}loadInitialData(){var t=this;return(0,m.A)(function*(){if(t.setupPageContent(),t.clienteId)try{const n=yield f(t.clienteService.getClienteById(t.clienteId).pipe((0,h.s)(1)));t.clienteNombre=n?.nombre||""}catch{return t.snackbarService.presentToastDanger("Error al cargar datos del cliente."),void t.router.navigate(["/private/televisores"])}else t.clienteService.getClientes().pipe((0,h.s)(1)).subscribe({next:n=>t.clientesDisponibles=n,error:n=>{console.error("Error al cargar clientes:",n),t.snackbarService.presentToastDanger("No se pudieron cargar los clientes.")}});t.loadTelevisores()})()}setupPageContent(){this.pageTitle=this.clienteId?`Televisores de ${this.clienteNombre}`:"Todos los Televisores",this.pageSubtitle=this.clienteId?"Gestiona los televisores de este cliente":"Gestiona todos los televisores del sistema",this.emptyStateMessage=this.clienteId?"Este cliente a\xfan no tiene televisores.":"No hay televisores en el sistema."}loadTelevisores(){this.televisorService.getTelevisores().pipe((0,h.s)(1)).subscribe({next:t=>{this.allTvs=t.map(n=>this.mapToTelevisorLocal(n)),this.filteredTvs=this.clienteId?this.allTvs.filter(n=>n.clienteId===this.clienteId):this.allTvs,this.loadTvImageCounts()},error:t=>{console.error("Error al cargar televisores:",t),this.snackbarService.presentToastDanger("Error fatal: No se pudieron cargar los televisores."),this.filteredTvs=[]}})}mapToTelevisorLocal(t){return{...t,imagenesCount:0,estado:t.estado,resolucion:t.configuracion?.resolucion||"N/A"}}loadTvImageCounts(){this.filteredTvs.forEach(t=>{this.imagenService.getImagenesByTelevisor(t.id).pipe((0,h.s)(1)).subscribe({next:n=>t.imagenesCount=n.length,error:n=>{console.error(`Error al contar im\xe1genes para TV ${t.id}:`,n),t.imagenesCount=0}})})}openNewTvModal(){new bootstrap.Modal(document.getElementById("newTvModal")).show()}onSubmitNewTv(){var t=this;return(0,m.A)(function*(){if(t.newTvForm.invalid)return void t.snackbarService.presentToastWarning("Por favor, completa todos los campos requeridos.");const n=t.newTvForm.value,o={nombre:n.nombre,ubicacion:n.ubicacion,clienteId:t.clienteId||n.clienteId,activo:!0,configuracion:{resolucion:n.resolucion,orientacion:"horizontal",tiempoTransicion:5e3}};try{yield t.televisorService.createTelevisor(o),t.snackbarService.presentToastSuccess("Televisor creado con \xe9xito"),t.loadTelevisores(),bootstrap.Modal.getInstance(document.getElementById("newTvModal"))?.hide()}catch{t.snackbarService.presentToastDanger("Error al crear el televisor")}})()}openImageModal(t){this.selectedTv=t,this.showImageModal=!0,this.loadTvImages(t.id)}closeImageModal(){this.showImageModal=!1,this.currentModalStep="images",this.resetScheduleStep()}loadTvImages(t){var n=this;return(0,m.A)(function*(){try{const o=n.imagenService.getImagenesByTelevisor(t).pipe((0,h.s)(1)),s=yield f(o);n.selectedTvImages=s.map((a,c)=>({...a,uiColor:n.colorPalette[c%n.colorPalette.length],showDetails:!1}))}catch{n.selectedTvImages=[],n.snackbarService.presentToastDanger("No se pudieron cargar las im\xe1genes.")}})()}programarImagen(t){this.selectedImage=t,this.currentModalStep="schedule",this.resetScheduleStep()}backToImages(){this.currentModalStep="images"}resetScheduleStep(){this.selectionStart=null,this.timeSlots.length>0&&this.timeSlots.forEach(t=>{"selected"===t.status&&(t.status="available")}),this.scheduleForm.reset({horaInicio:"",horaFin:""}),this.selectedDays=[],this.timeSlots=[]}static toMinutes(t){if(!t)return 0;const[n,o]=t.split(":").map(Number);return 60*n+o}getImageInitials(t){if(!t)return"?";const n=t.split(" ");return n.length>1?(n[0][0]+n[1][0]).toUpperCase():t.substring(0,2).toUpperCase()}buildScheduleTimeline(){if(0===this.selectedDays.length)return void(this.timeSlots=[]);const n=[];for(let s=0;s<1440;s+=30){const a=`${Math.floor(s/60).toString().padStart(2,"0")}:${(s%60).toString().padStart(2,"0")}`;n.push({time:a,status:"available"})}const o=this.selectedTvImages.flatMap(s=>s.horarios.map(a=>({...a,imageName:s.nombre,color:s.uiColor})));n.forEach(s=>{const a=i.toMinutes(s.time),c=a+30;for(const d of o)if(d.dias.some(_=>this.selectedDays.includes(_.value))){const _=i.toMinutes(d.horaInicio);if(a<i.toMinutes(d.horaFin)&&c>_){s.status="occupied",s.occupiedBy=d.imageName,s.color=d.color;break}}}),this.timeSlots=n}onTimeSlotClick(t){if("occupied"!==t.status){if(this.selectionStart===t)return void this.clearScheduleSelection();if(this.selectionStart){const n=this.timeSlots.indexOf(this.selectionStart),o=this.timeSlots.indexOf(t),[s,a]=n>o?[o,n]:[n,o],c=this.timeSlots.slice(s,a+1);if(c.some(p=>"occupied"===p.status))return this.snackbarService.presentToastDanger("La selecci\xf3n no puede cruzar un horario ocupado."),void this.clearScheduleSelection();this.clearScheduleSelection(!1),c.forEach(p=>p.status="selected");const d=a+1;this.scheduleForm.patchValue({horaInicio:this.timeSlots[s].time,horaFin:d<this.timeSlots.length?this.timeSlots[d].time:"23:59"})}else this.selectionStart=t,t.status="selected",this.scheduleForm.patchValue({horaInicio:t.time,horaFin:""})}}clearScheduleSelection(t=!0){this.timeSlots.forEach(n=>{"selected"===n.status&&(n.status="available")}),this.selectionStart=null,t&&this.scheduleForm.reset({horaInicio:"",horaFin:""})}checkScheduleConflict(t){const n=this.selectedTvImages.flatMap(a=>a.horarios.map(c=>({...c,imageName:a.nombre}))),o=i.toMinutes(t.horaInicio),s=i.toMinutes(t.horaFin);for(const a of n)if(a.dias.some(d=>t.dias.includes(d.value))){const d=i.toMinutes(a.horaInicio);if(o<i.toMinutes(a.horaFin)&&d<s)return{conflict:!0,message:`Conflicto con "${a.imageName}" (${a.horaInicio} - ${a.horaFin})`}}return{conflict:!1,message:""}}addScheduleToImage(){var t=this;return(0,m.A)(function*(){if(t.scheduleForm.invalid)return void t.snackbarService.presentToastWarning("El rango de horas no es v\xe1lido.");if(0===t.selectedDays.length)return void t.snackbarService.presentToastWarning("Debes seleccionar al menos un d\xeda.");const n=t.scheduleForm.value,o={...n,dias:t.selectedDays},s=t.checkScheduleConflict(o);if(s.conflict)return void t.snackbarService.presentToastDanger(s.message);t.guardandoHorario=!0;const a={...n,dias:t.getSelectedDaysAsObjects()};try{yield f(t.imagenService.agregarHorario(t.selectedImage.id,a)),t.snackbarService.presentToastSuccess("Horario guardado"),yield t.loadTvImages(t.selectedTv.id),t.backToImages()}catch{t.snackbarService.presentToastDanger("Error al guardar el horario")}finally{t.guardandoHorario=!1}})()}removeSchedule(t,n){var o=this;return(0,m.A)(function*(){if(confirm("\xbfEliminar este horario?"))try{yield f(o.imagenService.eliminarHorario(t.id,n)),o.snackbarService.presentToastSuccess("Horario eliminado"),yield o.loadTvImages(o.selectedTv.id)}catch{o.snackbarService.presentToastDanger("Error al eliminar")}})()}onDayChange(t){const n=this.selectedDays.indexOf(t.value);n>-1?this.selectedDays.splice(n,1):this.selectedDays.push(t.value),this.clearScheduleSelection(),this.buildScheduleTimeline()}selectAllDays(){this.selectedDays=this.diasSemana.map(t=>t.value),this.clearScheduleSelection(),this.buildScheduleTimeline()}selectWeekdays(){this.selectedDays=[1,2,3,4,5],this.clearScheduleSelection(),this.buildScheduleTimeline()}selectWeekends(){this.selectedDays=[6,0],this.clearScheduleSelection(),this.buildScheduleTimeline()}clearDays(){this.selectedDays=[],this.timeSlots=[],this.clearScheduleSelection()}getSelectedDaysAsObjects(){return this.diasSemana.filter(t=>this.selectedDays.includes(t.value))}getDaysText(t){if(!t||0===t.length)return"Sin d\xedas";if(7===t.length)return"Todos los d\xedas";const n={0:"D",1:"L",2:"M",3:"X",4:"J",5:"V",6:"S"};return t.map(o=>n[o.value]||"?").join(", ")}is24_7(t){return 0===t.horarios.length}onDragOver(t){t.preventDefault(),this.isDragOver=!0}onDragLeave(t){t.preventDefault(),this.isDragOver=!1}onMultipleDrop(t){t.preventDefault(),this.isDragOver=!1,t.dataTransfer?.files&&(this.selectedFiles=Array.from(t.dataTransfer.files))}onMultipleFileSelect(t){this.selectedFiles=Array.from(t.target.files)}removeSelectedFile(t){this.selectedFiles.splice(t,1)}uploadMultipleImages(){!this.selectedTv||0===this.selectedFiles.length||(this.isUploading=!0,setTimeout(()=>{this.isUploading=!1,this.snackbarService.presentToastSuccess(`${this.selectedFiles.length} im\xe1genes subidas (simulaci\xf3n)`),this.selectedFiles=[],this.loadTvImages(this.selectedTv.id),this.loadTelevisores()},1500))}deleteImage(t){confirm("\xbfEst\xe1s seguro?")&&this.imagenService.deleteImagen(t).subscribe({next:()=>{this.snackbarService.presentToastSuccess("Imagen eliminada"),this.loadTvImages(this.selectedTv.id),this.loadTelevisores()},error:n=>this.snackbarService.presentToastDanger("Error al eliminar la imagen")})}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(g.ok),e.rXU(b.nX),e.rXU(b.Ix),e.rXU(O.N),e.rXU(x.M),e.rXU(k.D),e.rXU(y))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-televisores"]],decls:15,vars:5,consts:[[1,"container","py-4"],[1,"header","mb-4"],[1,"mb-2"],[1,"text-muted"],[1,"d-flex","justify-content-end","align-items-center"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],["id","newTvModal","tabindex","-1",1,"modal","fade"],["class","row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4",4,"ngIf","ngIfElse"],["emptyState",""],["class","image-modal",3,"click",4,"ngIf"],[1,"row","row-cols-1","row-cols-md-2","row-cols-lg-3","g-4"],["class","col",4,"ngFor","ngForOf"],[1,"col"],[1,"card","h-100"],[1,"card-body","d-flex","flex-column"],[1,"card-title","mb-0"],[1,"bi","bi-tv","me-2"],[1,"mb-2","text-muted"],[1,"bi","bi-geo-alt","me-1"],[1,"mt-auto","border-top","pt-3","d-flex","justify-content-between","align-items-center"],[1,"bi","bi-images","me-1"],[1,"btn","btn-outline-primary","btn-sm",3,"click"],[1,"text-center","py-5"],[1,"bi","bi-tv","display-1","text-muted","mb-3"],[1,"image-modal",3,"click"],[1,"modal-container",3,"click"],[1,"modal-header"],[1,"btn-close",3,"click"],[1,"modal-body"],[1,"step-navigation","mb-4"],[1,"btn","step-btn",3,"click"],[1,"bi","bi-images","me-2"],[1,"btn","step-btn",3,"disabled"],[1,"bi","bi-calendar-plus","me-2"],[3,"ngSwitch"],[4,"ngSwitchCase"],["class","table table-hover image-table",4,"ngIf","ngIfElse"],["noImages",""],[1,"table","table-hover","image-table"],["scope","col",1,"color-legend-cell"],["scope","col"],["scope","col",1,"text-end"],[4,"ngFor","ngForOf"],[1,"color-swatch"],[3,"title"],[1,"image-thumbnail","me-2",3,"src"],["class","badge bg-success",4,"ngIf"],["class","schedules-list-in-table",4,"ngIf"],["class","badge bg-warning text-dark",4,"ngIf"],[1,"actions-cell","text-end"],["title","Programar",1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"bi","bi-clock"],["title","Eliminar",1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],[1,"badge","bg-success"],[1,"schedules-list-in-table"],["class","schedule-item-in-table",4,"ngFor","ngForOf"],[1,"schedule-item-in-table"],[1,"schedule-text"],["title","Eliminar horario",1,"btn","btn-sm","btn-outline-danger","ms-2",3,"click"],[1,"bi","bi-x-lg"],[1,"badge","bg-warning","text-dark"],[1,"bi","bi-image-alt","display-1","text-muted"],[1,"mt-3"],[1,"d-flex","align-items-center","mb-4"],[1,"btn","btn-outline-secondary","me-3",3,"click"],[1,"bi","bi-arrow-left"],[1,"mb-0"],[3,"formGroup","ngSubmit"],[1,"days-section","mb-4"],[1,"form-label","fw-bold"],[1,"days-grid"],["class","day-checkbox form-check form-check-inline",4,"ngFor","ngForOf"],["class","time-section mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"me-2"],["type","button",1,"btn","btn-sm","btn-link",3,"click"],[1,"d-flex","justify-content-end","mt-4"],["type","button",1,"btn","btn-secondary","me-2",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2",4,"ngIf"],[1,"day-checkbox","form-check","form-check-inline"],["type","checkbox",1,"form-check-input",3,"id","checked","change"],[1,"form-check-label",3,"for"],[1,"time-section","mb-3"],[1,"schedule-timeline"],[1,"timeline-slots"],["type","button","class","time-slot",3,"disabled","ngClass","background-color","border-color","title","click",4,"ngFor","ngForOf"],["type","button",1,"time-slot",3,"disabled","ngClass","title","click"],[4,"ngIf"],["class","slot-initials",4,"ngIf"],[1,"slot-initials"],[1,"spinner-border","spinner-border-sm","me-2"]],template:function(n,o){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"h1",2),e.EFF(3),e.k0s(),e.j41(4,"p",3),e.EFF(5),e.k0s(),e.j41(6,"div",4)(7,"button",5),e.bIt("click",function(){return o.openNewTvModal()}),e.nrm(8,"i",6),e.EFF(9," Nuevo Televisor "),e.k0s()()(),e.nrm(10,"div",7),e.DNE(11,I,2,1,"div",8),e.DNE(12,F,4,1,"ng-template",null,9,e.C5r),e.DNE(14,J,17,9,"div",10),e.k0s()),2&n){const s=e.sdS(13);e.R7$(3),e.JRh(o.pageTitle),e.R7$(2),e.JRh(o.pageSubtitle),e.R7$(6),e.Y8G("ngIf",o.filteredTvs.length>0)("ngIfElse",s),e.R7$(3),e.Y8G("ngIf",o.showImageModal)}},dependencies:[u.YU,u.Sq,u.bT,u.ux,u.e1,g.qT,g.cb,g.j4,u.Pc],styles:[".image-modal[_ngcontent-%COMP%]{position:fixed;inset:0;background:rgba(0,0,0,.6);-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:1050;animation:_ngcontent-%COMP%_fadeIn .3s ease-out}.image-modal[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]{background:white;border-radius:12px;box-shadow:0 20px 40px #00000026;max-width:900px;width:95%;max-height:90vh;overflow:hidden;animation:_ngcontent-%COMP%_slideIn .3s ease-out}.image-modal[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]{padding:1.5rem;border-bottom:1px solid #e9ecef;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff}.image-modal[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-weight:600}.image-modal[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]{filter:brightness(0) invert(1);opacity:.8}.image-modal[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]   .modal-header[_ngcontent-%COMP%]   .btn-close[_ngcontent-%COMP%]:hover{opacity:1}.image-modal[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{padding:1.5rem;max-height:calc(90vh - 140px);overflow-y:auto}.upload-section[_ngcontent-%COMP%]   .upload-area[_ngcontent-%COMP%]{border:2px dashed #dee2e6;border-radius:8px;background:#f8f9fa;transition:all .3s ease}.upload-section[_ngcontent-%COMP%]   .upload-area.drag-over[_ngcontent-%COMP%]{border-color:#007bff;background:#e3f2fd;transform:scale(1.02)}.upload-section[_ngcontent-%COMP%]   .upload-area[_ngcontent-%COMP%]:hover{border-color:#6c757d}.upload-section[_ngcontent-%COMP%]   .selected-files[_ngcontent-%COMP%]   .files-grid[_ngcontent-%COMP%]{display:grid;gap:.5rem;margin:1rem 0}.upload-section[_ngcontent-%COMP%]   .selected-files[_ngcontent-%COMP%]   .file-preview[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.5rem;background:#f8f9fa;border-radius:6px;border:1px solid #dee2e6}.upload-section[_ngcontent-%COMP%]   .selected-files[_ngcontent-%COMP%]   .file-preview[_ngcontent-%COMP%]   .file-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;font-size:.9rem;margin-left:.5rem}.upload-section[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]{height:8px;border-radius:4px;overflow:hidden}.upload-section[_ngcontent-%COMP%]   .progress[_ngcontent-%COMP%]   .progress-bar[_ngcontent-%COMP%]{background:linear-gradient(90deg,#28a745,#20c997);transition:width .3s ease}.images-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.5rem;margin-top:1.5rem}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]{border:1px solid #dee2e6;border-radius:12px;overflow:hidden;background:white;box-shadow:0 2px 8px #00000014;transition:all .3s ease}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 8px 25px #00000026}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{position:relative;overflow:hidden}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{width:100%;height:180px;object-fit:cover;transition:transform .3s ease}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:flex;gap:4px;opacity:0;transition:opacity .3s ease}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);background:rgba(255,255,255,.9);border:none;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]   .btn.btn-primary[_ngcontent-%COMP%]{background:rgba(0,123,255,.9);color:#fff}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]   .btn.btn-warning[_ngcontent-%COMP%]{background:rgba(255,193,7,.9);color:#fff}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   .image-overlay[_ngcontent-%COMP%]   .btn.btn-danger[_ngcontent-%COMP%]{background:rgba(220,53,69,.9);color:#fff}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]:hover   .image-preview[_ngcontent-%COMP%]{transform:scale(1.05)}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]:hover   .image-overlay[_ngcontent-%COMP%]{opacity:1}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]{padding:1rem}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   .image-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.5rem;color:#495057}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   .schedule-summary[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{font-size:.75rem;padding:.4em .6em}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   .schedule-summary[_ngcontent-%COMP%]   .badge.bg-success[_ngcontent-%COMP%]{background:linear-gradient(135deg,#28a745,#20c997)!important}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   .schedule-summary[_ngcontent-%COMP%]   .badge.bg-info[_ngcontent-%COMP%]{background:linear-gradient(135deg,#17a2b8,#6f42c1)!important}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   .schedules-list[_ngcontent-%COMP%]   .schedule-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.5rem;background:#f8f9fa;border-radius:6px;margin-bottom:.5rem;border-left:3px solid #007bff}.images-grid[_ngcontent-%COMP%]   .image-card[_ngcontent-%COMP%]   .image-info[_ngcontent-%COMP%]   .schedules-list[_ngcontent-%COMP%]   .schedule-item[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{line-height:1.3}.schedule-step[_ngcontent-%COMP%]   .days-section[_ngcontent-%COMP%]   .quick-select-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:.5rem}.schedule-step[_ngcontent-%COMP%]   .days-section[_ngcontent-%COMP%]   .days-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.75rem;margin-top:1rem}.schedule-step[_ngcontent-%COMP%]   .days-section[_ngcontent-%COMP%]   .days-grid[_ngcontent-%COMP%]   .day-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.75rem;background:#f8f9fa;border:1px solid #dee2e6;border-radius:8px;transition:all .3s ease;cursor:pointer}.schedule-step[_ngcontent-%COMP%]   .days-section[_ngcontent-%COMP%]   .days-grid[_ngcontent-%COMP%]   .day-checkbox[_ngcontent-%COMP%]:hover{background:#e9ecef;border-color:#007bff}.schedule-step[_ngcontent-%COMP%]   .days-section[_ngcontent-%COMP%]   .days-grid[_ngcontent-%COMP%]   .day-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]{margin-right:.5rem;transform:scale(1.2)}.schedule-step[_ngcontent-%COMP%]   .days-section[_ngcontent-%COMP%]   .days-grid[_ngcontent-%COMP%]   .day-checkbox[_ngcontent-%COMP%]   input[type=checkbox][_ngcontent-%COMP%]:checked + label[_ngcontent-%COMP%]{color:#007bff;font-weight:600}.schedule-step[_ngcontent-%COMP%]   .days-section[_ngcontent-%COMP%]   .days-grid[_ngcontent-%COMP%]   .day-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer;margin:0;font-size:.9rem}.add-image-card[_ngcontent-%COMP%]{border:2px dashed #dee2e6;border-radius:8px;display:flex;align-items:center;justify-content:center;min-height:200px;transition:all .2s ease}.add-image-card[_ngcontent-%COMP%]:hover{border-color:#007bff;background-color:#f8f9fa}.upload-area-small[_ngcontent-%COMP%]{text-align:center;padding:1rem}.upload-area-small.drag-over[_ngcontent-%COMP%]{background-color:#e3f2fd;border-color:#2196f3}.empty-state[_ngcontent-%COMP%]{color:#6c757d}.empty-state[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{opacity:.5}.empty-state[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:#495057;font-weight:500}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_slideIn{0%{opacity:0;transform:translateY(-20px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}@media (max-width: 768px){.image-modal[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]{width:98%;max-height:95vh;margin:1rem}.image-modal[_ngcontent-%COMP%]   .modal-container[_ngcontent-%COMP%]   .modal-body[_ngcontent-%COMP%]{padding:1rem}.images-grid[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:1rem}.schedule-step[_ngcontent-%COMP%]   .days-section[_ngcontent-%COMP%]   .days-grid[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}.upload-section[_ngcontent-%COMP%]   .selected-files[_ngcontent-%COMP%]   .files-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:500}.card[_ngcontent-%COMP%]{box-shadow:0 2px 4px #00000014;transition:box-shadow .3s ease}.card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 12px #0000001f}.card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:500}.image-table[_ngcontent-%COMP%]{vertical-align:middle}.image-table[_ngcontent-%COMP%]   .color-legend-cell[_ngcontent-%COMP%]{width:1%}.image-table[_ngcontent-%COMP%]   .color-swatch[_ngcontent-%COMP%]{width:20px;height:20px;border-radius:50%;border:1px solid rgba(0,0,0,.1)}.image-table[_ngcontent-%COMP%]   .image-thumbnail[_ngcontent-%COMP%]{width:60px;height:45px;object-fit:cover;border-radius:.25rem}.image-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{max-width:200px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.image-table[_ngcontent-%COMP%]   .actions-cell[_ngcontent-%COMP%]{width:1%;white-space:nowrap}.image-table[_ngcontent-%COMP%]   .schedules-list-in-table[_ngcontent-%COMP%]{font-size:.85rem;line-height:1.3}.image-table[_ngcontent-%COMP%]   .schedules-list-in-table[_ngcontent-%COMP%]   .schedule-item-in-table[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:.2rem 0;border-bottom:1px dashed #eee}.image-table[_ngcontent-%COMP%]   .schedules-list-in-table[_ngcontent-%COMP%]   .schedule-item-in-table[_ngcontent-%COMP%]:last-child{border-bottom:none}.image-table[_ngcontent-%COMP%]   .schedules-list-in-table[_ngcontent-%COMP%]   .schedule-item-in-table[_ngcontent-%COMP%]   .schedule-text[_ngcontent-%COMP%]{flex-grow:1;margin-right:.5rem}.image-table[_ngcontent-%COMP%]   .schedules-list-in-table[_ngcontent-%COMP%]   .schedule-item-in-table[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.1rem .3rem;font-size:.7rem}.schedule-timeline[_ngcontent-%COMP%]{border:1px solid #dee2e6;border-radius:.375rem;padding:1rem;background-color:#f8f9fa}.schedule-timeline[_ngcontent-%COMP%]   .timeline-slots[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:5px}.schedule-timeline[_ngcontent-%COMP%]   .time-slot[_ngcontent-%COMP%]{flex-grow:1;border:1px solid;font-size:.75rem;padding:.5rem .25rem;text-align:center;transition:all .2s ease;min-width:45px;color:#333}.schedule-timeline[_ngcontent-%COMP%]   .time-slot.is-available[_ngcontent-%COMP%]{border-color:#ccc;background-color:#fff}.schedule-timeline[_ngcontent-%COMP%]   .time-slot.is-available[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.schedule-timeline[_ngcontent-%COMP%]   .time-slot[style*=background-color][_ngcontent-%COMP%]{color:#fff;text-decoration:line-through}.schedule-timeline[_ngcontent-%COMP%]   .time-slot.is-selected[_ngcontent-%COMP%]{border-color:#007bff;background-color:#007bff;color:#fff;font-weight:700}.schedule-timeline[_ngcontent-%COMP%]   .time-slot[_ngcontent-%COMP%]   .slot-initials[_ngcontent-%COMP%]{font-weight:700;font-size:.8rem}"]})}}return i})();const L=[{path:"",component:P},{path:":clienteId",component:P}];let W=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[b.iI.forChild(L),b.iI]})}}return i})(),K=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[W,C.PrivateModule,u.MD,g.X1,g.YN]})}}return i})()}}]);