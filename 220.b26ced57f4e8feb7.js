"use strict";(self.webpackChunktv_manager=self.webpackChunktv_manager||[]).push([[220],{7220:(_,m,a)=>{a.r(m),a.d(m,{UsersPageModule:()=>P});var b=a(7970),i=a(4341),d=a(177),f=a(9559),c=a(467),e=a(7705),h=a(6354),p=a(6697),g=a(8515);let F=(()=>{class o{constructor(t){this.firestore=t,this.collection="usuarios"}getUsers(){return this.firestore.collection(this.collection).snapshotChanges().pipe((0,h.T)(t=>t.map(r=>{const s=r.payload.doc.data(),n=r.payload.doc.id;return s.fechaCreacion&&"object"==typeof s.fechaCreacion&&"toDate"in s.fechaCreacion&&(s.fechaCreacion=s.fechaCreacion.toDate()),{id:n,...s}})))}getUserById(t){return this.firestore.collection(this.collection).doc(t).valueChanges().pipe((0,p.s)(1))}createUser(t){var r=this;return(0,c.A)(function*(){const s={...t,fechaCreacion:new Date};yield r.firestore.collection(r.collection).add(s)})()}updateUser(t){var r=this;return(0,c.A)(function*(){if(!t.id)throw new Error("El usuario debe tener un ID para ser actualizado.");const{id:s,...n}=t;yield r.firestore.collection(r.collection).doc(t.id).update(n)})()}deleteUser(t){var r=this;return(0,c.A)(function*(){yield r.firestore.collection(r.collection).doc(t).delete()})()}static{this.\u0275fac=function(r){return new(r||o)(e.KVO(g.Qe))}}static{this.\u0275prov=e.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var v=a(7763);function k(o,l){1&o&&(e.j41(0,"div",33),e.nrm(1,"i",34),e.j41(2,"h3"),e.EFF(3,"No hay usuarios registrados"),e.k0s(),e.j41(4,"p",35),e.EFF(5,'Haz clic en "Nuevo Usuario" para comenzar.'),e.k0s()())}function E(o,l){if(1&o){const t=e.RV6();e.j41(0,"tr")(1,"td"),e.EFF(2),e.k0s(),e.j41(3,"td"),e.EFF(4),e.k0s(),e.j41(5,"td"),e.EFF(6),e.k0s(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td")(10,"span",40),e.EFF(11),e.k0s()(),e.j41(12,"td"),e.EFF(13),e.k0s(),e.j41(14,"td",38)(15,"button",41),e.bIt("click",function(){const n=e.eBV(t).$implicit,u=e.XpG(2);return e.Njj(u.openEditModal(n))}),e.nrm(16,"i",42),e.k0s(),e.j41(17,"button",43),e.bIt("click",function(){const n=e.eBV(t).$implicit,u=e.XpG(2);return e.Njj(u.deleteUser(n))}),e.nrm(18,"i",44),e.k0s()()()}if(2&o){const t=l.$implicit,r=e.XpG(2);e.R7$(2),e.JRh(t.nombre),e.R7$(2),e.JRh(t.username),e.R7$(2),e.JRh(t.email),e.R7$(2),e.JRh(r.getRoleText(t.role)),e.R7$(2),e.Y8G("ngClass",t.activo?"bg-success":"bg-danger"),e.R7$(1),e.SpI(" ",t.activo?"S\xed":"No"," "),e.R7$(2),e.JRh(r.formatDate(t.fechaCreacion))}}function U(o,l){if(1&o&&(e.j41(0,"div",36)(1,"table",37)(2,"thead")(3,"tr")(4,"th"),e.EFF(5,"Nombre"),e.k0s(),e.j41(6,"th"),e.EFF(7,"Username"),e.k0s(),e.j41(8,"th"),e.EFF(9,"Email"),e.k0s(),e.j41(10,"th"),e.EFF(11,"Rol"),e.k0s(),e.j41(12,"th"),e.EFF(13,"Activo"),e.k0s(),e.j41(14,"th"),e.EFF(15,"Fecha Creaci\xf3n"),e.k0s(),e.j41(16,"th",38),e.EFF(17,"Acciones"),e.k0s()()(),e.j41(18,"tbody"),e.DNE(19,E,19,7,"tr",39),e.k0s()()()),2&o){const t=e.XpG();e.R7$(19),e.Y8G("ngForOf",t.filteredUsers)}}function j(o,l){1&o&&(e.j41(0,"small",45),e.EFF(1,"M\xednimo 6 caracteres."),e.k0s())}function y(o,l){1&o&&(e.j41(0,"small",45),e.EFF(1,"Dejar en blanco para no cambiar."),e.k0s())}function C(o,l){if(1&o&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&o){const t=l.$implicit,r=e.XpG();e.Y8G("value",t),e.R7$(1),e.JRh(r.getRoleText(t))}}const M=[{path:"",component:(()=>{class o{constructor(t,r,s){this.fb=t,this.userService=r,this.snackbarService=s,this.filteredUsers=[],this.showUserModal=!1,this.isEditMode=!1,this.currentUser=null,this.roles=["admin","editor","normal"],this.users$=this.userService.getUsers()}ngOnInit(){this.initializeForm(),this.users$.subscribe(t=>{this.filteredUsers=t})}initializeForm(){this.userForm=this.fb.group({id:[null],nombre:["",i.k0.required],username:["",i.k0.required],email:["",[i.k0.required,i.k0.email]],password:["",[i.k0.required,i.k0.minLength(6)]],role:["normal",i.k0.required],activo:[!0]})}openCreateModal(){this.isEditMode=!1,this.currentUser=null,this.userForm.reset({nombre:"",username:"",email:"",password:"",role:"normal",activo:!0}),this.userForm.get("password")?.enable(),new bootstrap.Modal(document.getElementById("userModal")).show()}openEditModal(t){this.isEditMode=!0,this.currentUser=t,this.userForm.patchValue(t),this.userForm.get("password")?.disable(),new bootstrap.Modal(document.getElementById("userModal")).show()}closeUserModal(){bootstrap.Modal.getInstance(document.getElementById("userModal"))?.hide(),this.userForm.reset()}onSubmit(){var t=this;return(0,c.A)(function*(){if(t.userForm.invalid)return void t.snackbarService.presentToastWarning("Por favor, completa todos los campos requeridos.");const r=t.userForm.getRawValue();try{t.isEditMode?(yield t.userService.updateUser(r),t.snackbarService.presentToastSuccess("Usuario actualizado con \xe9xito")):(yield t.userService.createUser(r),t.snackbarService.presentToastSuccess("Usuario creado con \xe9xito")),t.closeUserModal()}catch(s){console.error("Error al guardar usuario:",s),t.snackbarService.presentToastDanger("Error al guardar usuario.")}})()}deleteUser(t){var r=this;return(0,c.A)(function*(){if(t.id&&confirm(`\xbfEst\xe1s seguro de que quieres eliminar a ${t.username}?`))try{yield r.userService.deleteUser(t.id),r.snackbarService.presentToastSuccess("Usuario eliminado con \xe9xito")}catch(s){console.error("Error al eliminar usuario:",s),r.snackbarService.presentToastDanger("Error al eliminar usuario.")}})()}getRoleText(t){switch(t){case"admin":return"Administrador";case"editor":return"Editor";case"normal":return"Normal";default:return t}}formatDate(t){return t?new Date(t).toLocaleDateString():"N/A"}static{this.\u0275fac=function(r){return new(r||o)(e.rXU(i.ok),e.rXU(F),e.rXU(v.z))}}static{this.\u0275cmp=e.VBU({type:o,selectors:[["app-users"]],decls:50,vars:9,consts:[[1,"container","py-4"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"btn","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],["class","text-center py-5",4,"ngIf"],["class","table-responsive",4,"ngIf"],["id","userModal","tabindex","-1","aria-labelledby","userModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","userModalLabel",1,"modal-title"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"formGroup","ngSubmit"],[1,"mb-3"],["for","nombre",1,"form-label"],["type","text","id","nombre","formControlName","nombre",1,"form-control"],["for","username",1,"form-label"],["type","text","id","username","formControlName","username",1,"form-control"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email",1,"form-control"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password",1,"form-control"],["class","form-text text-muted",4,"ngIf"],["for","role",1,"form-label"],["id","role","formControlName","role",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],[1,"form-check","form-switch","mb-3"],["type","checkbox","id","activo","formControlName","activo",1,"form-check-input"],["for","activo",1,"form-check-label"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-secondary"],["type","submit",1,"btn","btn-primary",3,"disabled","click"],[1,"text-center","py-5"],[1,"bi","bi-person-fill-slash","display-1","text-muted","mb-3"],[1,"text-muted"],[1,"table-responsive"],[1,"table","table-hover","align-middle"],[1,"text-end"],[4,"ngFor","ngForOf"],[1,"badge",3,"ngClass"],[1,"btn","btn-sm","btn-outline-primary","me-2",3,"click"],[1,"bi","bi-pencil"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],[1,"form-text","text-muted"],[3,"value"]],template:function(r,s){1&r&&(e.j41(0,"div",0)(1,"div",1)(2,"h1"),e.EFF(3,"Gesti\xf3n de Usuarios"),e.k0s(),e.j41(4,"button",2),e.bIt("click",function(){return s.openCreateModal()}),e.nrm(5,"i",3),e.EFF(6,"Nuevo Usuario "),e.k0s()(),e.DNE(7,k,6,0,"div",4),e.DNE(8,U,20,1,"div",5),e.j41(9,"div",6)(10,"div",7)(11,"div",8)(12,"div",9)(13,"h5",10),e.EFF(14),e.k0s(),e.nrm(15,"button",11),e.k0s(),e.j41(16,"div",12)(17,"form",13),e.bIt("ngSubmit",function(){return s.onSubmit()}),e.j41(18,"div",14)(19,"label",15),e.EFF(20,"Nombre"),e.k0s(),e.nrm(21,"input",16),e.k0s(),e.j41(22,"div",14)(23,"label",17),e.EFF(24,"Username"),e.k0s(),e.nrm(25,"input",18),e.k0s(),e.j41(26,"div",14)(27,"label",19),e.EFF(28,"Email"),e.k0s(),e.nrm(29,"input",20),e.k0s(),e.j41(30,"div",14)(31,"label",21),e.EFF(32,"Contrase\xf1a"),e.k0s(),e.nrm(33,"input",22),e.DNE(34,j,2,0,"small",23),e.DNE(35,y,2,0,"small",23),e.k0s(),e.j41(36,"div",14)(37,"label",24),e.EFF(38,"Rol"),e.k0s(),e.j41(39,"select",25),e.DNE(40,C,2,2,"option",26),e.k0s()(),e.j41(41,"div",27),e.nrm(42,"input",28),e.j41(43,"label",29),e.EFF(44,"Activo"),e.k0s()()()(),e.j41(45,"div",30)(46,"button",31),e.EFF(47,"Cancelar"),e.k0s(),e.j41(48,"button",32),e.bIt("click",function(){return s.onSubmit()}),e.EFF(49),e.k0s()()()()()()),2&r&&(e.R7$(7),e.Y8G("ngIf",0===s.filteredUsers.length),e.R7$(1),e.Y8G("ngIf",s.filteredUsers.length>0),e.R7$(6),e.JRh(s.isEditMode?"Editar Usuario":"Nuevo Usuario"),e.R7$(3),e.Y8G("formGroup",s.userForm),e.R7$(17),e.Y8G("ngIf",!s.isEditMode),e.R7$(1),e.Y8G("ngIf",s.isEditMode),e.R7$(5),e.Y8G("ngForOf",s.roles),e.R7$(8),e.Y8G("disabled",s.userForm.invalid),e.R7$(1),e.SpI(" ",s.isEditMode?"Guardar Cambios":"Crear Usuario"," "))},dependencies:[d.YU,d.Sq,d.bT,i.qT,i.xH,i.y7,i.me,i.Zm,i.wz,i.BC,i.cb,i.j4,i.JD],styles:[".table[_ngcontent-%COMP%]{font-size:.9rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{font-weight:600;background-color:#f8f9fa}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.table[_ngcontent-%COMP%]   .badge[_ngcontent-%COMP%]{padding:.4em .7em}.table[_ngcontent-%COMP%]   .btn-sm[_ngcontent-%COMP%]{padding:.25rem .5rem;font-size:.75rem}.modal-content[_ngcontent-%COMP%]   .form-label[_ngcontent-%COMP%]{font-weight:500}.bi[_ngcontent-%COMP%]{font-size:1rem}"]})}}return o})()}];let R=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[f.iI.forChild(M),f.iI]})}}return o})(),P=(()=>{class o{static{this.\u0275fac=function(r){return new(r||o)}}static{this.\u0275mod=e.$C({type:o})}static{this.\u0275inj=e.G2t({imports:[R,b.PrivateModule,d.MD,i.X1,i.YN]})}}return o})()}}]);